<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <!-- 1. ĐÃ SỬA TIÊU ĐỀ -->
    <title>Didi Studio</title>
    
    <!-- THƯ VIỆN -->
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/PapaParse/5.4.1/papaparse.min.js"></script>
    
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Outfit:wght@300;400;600;700&display=swap');
        body { font-family: 'Outfit', sans-serif; background-color: #050505; color: #e5e5e5; }
        .no-scrollbar::-webkit-scrollbar { display: none; }

        /* --- GRID CARD --- */
        .product-card { transition: transform 0.2s; cursor: pointer; -webkit-tap-highlight-color: transparent; }
        .product-card:active { transform: scale(0.97); }

        /* --- MODAL --- */
        #productModal { backdrop-filter: blur(10px); transition: opacity 0.2s ease; }
        .modal-content { transition: transform 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275); transform: scale(0.9); opacity: 0; }
        #productModal.open .modal-content { transform: scale(1); opacity: 1; }

        /* --- 2. HIỆU ỨNG LẬT 3D MỚI (SIÊU MƯỢT) --- */
        .perspective-1000 { perspective: 1000px; }
        
        /* Khối chứa 2 mặt */
        #flipInner {
            position: relative;
            width: 100%; height: 100%;
            text-align: center;
            transition: transform 0.8s cubic-bezier(0.4, 0, 0.2, 1); /* Thời gian và độ mượt */
            transform-style: preserve-3d;
        }

        /* Class để kích hoạt lật */
        .do-flip { transform: rotateY(180deg); }

        /* Định dạng chung cho mặt trước và sau */
        .flip-face {
            position: absolute; inset: 0;
            width: 100%; height: 100%;
            -webkit-backface-visibility: hidden; /* Safari */
            backface-visibility: hidden;
            border-radius: 0.75rem; /* rounded-xl */
            overflow: hidden;
        }

        /* Mặt sau (xoay sẵn 180 độ) */
        .flip-back { transform: rotateY(180deg); }

        /* --- UI KHÁC --- */
        .cat-btn.active { color: #fed7aa; border-bottom: 2px solid #fed7aa; }
        .wheel-container {
            position: relative; width: 280px; height: 280px; border-radius: 50%; border: 4px solid #333;
            background: conic-gradient(#ef4444 0deg 60deg, #14b8a6 60deg 120deg, #ef4444 120deg 180deg, #14b8a6 180deg 240deg, #ef4444 240deg 300deg, #14b8a6 300deg 360deg);
            transition: transform 4s cubic-bezier(0.17, 0.67, 0.12, 0.99);
        }
        .wheel-pointer { position: absolute; top: -15px; left: 50%; transform: translateX(-50%); border-left: 15px solid transparent; border-right: 15px solid transparent; border-top: 25px solid #fff; z-index: 10; }
    </style>
</head>
<body class="pb-24 min-h-screen flex flex-col">

    <!-- HEADER -->
    <header class="sticky top-0 z-40 bg-black/90 backdrop-blur-xl border-b border-white/5 pt-4 pb-0">
        <div class="max-w-md mx-auto px-4 flex justify-between items-center mb-4">
            <div class="text-lg font-bold tracking-[0.2em] text-white">DIDI<span class="text-orange-300">STUDIO</span></div>
            <div class="relative w-1/2">
                <input type="text" id="searchInput" onkeyup="filterProducts()" placeholder="Tìm mã..." 
                    class="w-full bg-[#1a1a1a] text-white text-xs rounded-full pl-8 pr-4 py-2 focus:outline-none border border-gray-800 focus:border-orange-300/50 transition-colors placeholder-gray-600">
                <i class="fa-solid fa-search absolute left-3 top-2.5 text-gray-500 text-[10px]"></i>
            </div>
        </div>
        <div class="max-w-md mx-auto px-4">
            <div class="flex gap-6 overflow-x-auto no-scrollbar pb-0 text-xs font-medium uppercase tracking-wide text-gray-500 h-8">
                <button onclick="setCategory('all')" class="cat-btn active transition-colors h-full">Tất cả</button>
                <button onclick="setCategory('dam')" class="cat-btn transition-colors h-full hover:text-white">Đầm</button>
                <button onclick="setCategory('ao')" class="cat-btn transition-colors h-full hover:text-white">Áo</button>
                <button onclick="setCategory('quan')" class="cat-btn transition-colors h-full hover:text-white">Quần</button>
                <button onclick="setCategory('phukien')" class="cat-btn transition-colors h-full hover:text-white">Phụ Kiện</button>
            </div>
        </div>
    </header>

    <!-- DANH SÁCH SẢN PHẨM -->
    <main class="max-w-md mx-auto px-4 py-6 flex-grow">
        <div id="loading" class="hidden text-center py-10 text-gray-600 text-xs">
            <i class="fa-solid fa-circle-notch fa-spin mb-2 text-xl"></i><br>Đang tải dữ liệu...
        </div>
        <div id="productList" class="grid grid-cols-2 gap-4"></div>
        <div id="emptyState" class="hidden text-center py-20 text-gray-600">
            <i class="fa-solid fa-ghost text-2xl mb-2"></i><p class="text-xs">Không tìm thấy sản phẩm</p>
        </div>
    </main>

    <!-- MODAL ZOOM (CẤU TRÚC MỚI) -->
    <div id="productModal" class="fixed inset-0 z-[100] bg-black/95 hidden flex items-center justify-center px-4" onclick="closeModal()">
        <div class="modal-content w-full max-w-md flex flex-col items-center relative" onclick="event.stopPropagation()">
            
            <!-- Nút đóng X -->
            <button onclick="closeModal()" class="absolute -top-12 right-0 text-white text-3xl z-50 p-2 hover:scale-110 transition">
                <i class="fa-solid fa-xmark"></i>
            </button>

            <!-- Container 3D Flip -->
            <div class="perspective-1000 relative w-full aspect-[3/4] cursor-pointer" onclick="flipModalImage()">
                <div id="flipInner">
                    
                    <!-- MẶT TRƯỚC -->
                    <div class="flip-face bg-[#111] border border-white/10 shadow-2xl">
                        <img id="modalImgFront" src="" class="w-full h-full object-cover">
                        <!-- Chỉ dẫn mặt trước -->
                        <div class="absolute bottom-4 left-0 w-full text-center pointer-events-none">
                            <span class="text-white/60 text-[10px] bg-black/50 px-3 py-1 rounded-full backdrop-blur-md">
                                <i class="fa-solid fa-hand-pointer mr-1"></i> Chạm để lật
                            </span>
                        </div>
                        <div class="absolute top-3 right-3 text-white/80 bg-black/40 p-2 rounded-full pointer-events-none">
                            <i class="fa-solid fa-rotate text-sm"></i>
                        </div>
                    </div>

                    <!-- MẶT SAU -->
                    <div class="flip-face flip-back bg-[#111] border border-white/10 shadow-2xl">
                        <img id="modalImgBack" src="" class="w-full h-full object-cover">
                        <!-- Chỉ dẫn mặt sau -->
                        <div class="absolute bottom-4 left-0 w-full text-center pointer-events-none">
                            <span class="text-white/60 text-[10px] bg-black/50 px-3 py-1 rounded-full backdrop-blur-md">
                                <i class="fa-solid fa-rotate-left mr-1"></i> Chạm để quay lại
                            </span>
                        </div>
                    </div>

                </div>
            </div>

            <!-- Thông tin & Nút Mua -->
            <div class="mt-6 w-full text-center">
                <h2 id="modalCode" class="text-2xl font-bold text-white tracking-widest mb-1">CODE</h2>
                <p id="modalName" class="text-gray-400 text-sm mb-6">Tên sản phẩm</p>
                
                <div class="flex gap-3 justify-center w-full">
                    <a id="modalShopee" href="#" target="_blank" class="flex-1 py-3 rounded-lg bg-[#ee4d2d] hover:bg-orange-600 text-white font-bold flex justify-center items-center gap-2 transition transform active:scale-95">
                        <img src="https://upload.wikimedia.org/wikipedia/commons/f/fe/Shopee.svg" class="h-5 brightness-0 invert"> Shopee
                    </a>
                    <a id="modalTiktok" href="#" target="_blank" class="flex-1 py-3 rounded-lg bg-white hover:bg-gray-200 text-black font-bold flex justify-center items-center gap-2 transition transform active:scale-95">
                        <i class="fa-brands fa-tiktok text-xl"></i> TikTok
                    </a>
                </div>
            </div>
        </div>
    </div>

    <!-- FLOATING BUTTONS -->
    <div class="fixed bottom-6 right-4 flex flex-col gap-3 z-[60]">
        <button onclick="openWheel()" class="w-10 h-10 bg-gradient-to-br from-pink-600 to-purple-600 rounded-full shadow-lg text-white flex items-center justify-center animate-bounce"><i class="fa-solid fa-gift text-sm"></i></button>
        <a href="https://www.tiktok.com/@username" target="_blank" class="w-10 h-10 bg-black border border-gray-700 rounded-full shadow-lg text-white flex items-center justify-center hover:scale-110 transition"><i class="fa-brands fa-tiktok text-sm"></i></a>
    </div>

    <!-- VÒNG QUAY -->
    <div id="wheelModal" class="fixed inset-0 z-[90] hidden flex items-center justify-center px-4 bg-black/90 backdrop-blur-sm">
        <div class="bg-[#181818] w-full max-w-xs rounded-2xl p-6 border border-gray-800 flex flex-col items-center relative shadow-2xl">
            <button onclick="closeWheel()" class="absolute top-3 right-4 text-gray-500 hover:text-white"><i class="fa-solid fa-xmark"></i></button>
            <h3 class="text-lg font-bold text-white mb-1">Vòng Quay May Mắn</h3>
            <div class="relative mb-6 mt-4">
                <div class="wheel-pointer"></div>
                <div id="wheel" class="wheel-container relative">
                    <span class="absolute top-10 right-10 text-white font-bold text-[10px] rotate-45">SALE</span>
                    <span class="absolute top-10 left-10 text-white font-bold text-[10px] -rotate-45">MISS</span>
                </div>
                <button onclick="spinWheel()" id="spinBtn" class="absolute top-1/2 left-1/2 transform -translate-x-1/2 -translate-y-1/2 w-12 h-12 bg-white text-black font-bold rounded-full text-xs shadow-lg border-2 border-gray-300 z-10">QUAY</button>
            </div>
            <div id="wheelResult" class="text-center h-6 text-sm font-bold text-teal-400"></div>
        </div>
    </div>

    <!-- JAVASCRIPT -->
    <script>
        const USE_GOOGLE_SHEET = true; 
        
        // --- LINK CSV CHUẨN CỦA BẠN ---
        const SHEET_URL = 'https://docs.google.com/spreadsheets/d/e/2PACX-1vQJs9fScBM0g7yKHn2JC6fi5EK9T5uUyyr-oaQeIQkvKrT8v2NKi-8Bx3V0pugjeVXH3Gqtn1aCQTNh/pub?gid=0&single=true&output=csv'; 
        
        // LINK GITHUB ẢNH
        const GITHUB_IMAGE_BASE = "https://wnoS125.github.io/didistudio/images/";
        const IS_OUT_OF_STOCK = false; 

        let allProducts = [];
        let currentCategory = 'all';

        function init() {
            if(USE_GOOGLE_SHEET) {
                document.getElementById('loading').classList.remove('hidden');
                Papa.parse(SHEET_URL, {
                    download: true, header: true,
                    complete: function(results) {
                        allProducts = results.data.map((row, idx) => {
                            let imgs = [];
                            if (row.image1 && row.image1.length > 5) imgs.push(row.image1);
                            if (row.image2 && row.image2.length > 5) imgs.push(row.image2);
                            if (imgs.length === 0 && row.code) {
                                imgs.push(GITHUB_IMAGE_BASE + row.code + "-1.jpeg");
                                imgs.push(GITHUB_IMAGE_BASE + row.code + "-2.jpeg");
                            }
                            return {
                                id: idx,
                                code: row.code || '???',
                                category: row.category ? row.category.toLowerCase().trim() : 'khac',
                                name: row.name || 'Sản phẩm mới',
                                images: imgs,
                                isHot: (row.is_hot === 'TRUE'),
                                links: { shopee: row.shopee_link, tiktok: row.tiktok_link }
                            };
                        });
                        document.getElementById('loading').classList.add('hidden');
                        filterProducts();
                    },
                    error: function() { alert("Lỗi tải dữ liệu!"); }
                });
            }
        }

        function renderProducts(data) {
            const container = document.getElementById('productList');
            const empty = document.getElementById('emptyState');
            container.innerHTML = '';

            if(data.length === 0) { empty.classList.remove('hidden'); return; }
            empty.classList.add('hidden');
            
            data.forEach(p => {
                const img1 = p.images[0];
                const html = `
                    <div class="product-card relative rounded-lg overflow-hidden border border-white/5 shadow-lg group" 
                         onclick="openModal(${p.id})">
                        <div class="aspect-[3/4] bg-[#111] relative">
                            <img src="${img1}" onerror="this.src='https://via.placeholder.com/300x400?text=Loading'" class="w-full h-full object-cover">
                            <div class="absolute bottom-0 left-0 w-full bg-gradient-to-t from-black via-black/60 to-transparent p-3 pt-6">
                                <div class="text-white font-bold tracking-widest">${p.code}</div>
                                <div class="text-gray-400 text-[10px] truncate">${p.name}</div>
                            </div>
                            ${p.isHot ? '<div class="absolute top-2 left-2 text-orange-500 animate-pulse"><i class="fa-solid fa-fire"></i></div>' : ''}
                        </div>
                    </div>
                `;
                container.innerHTML += html;
            });
        }

        // --- LOGIC MODAL 3D MỚI ---
        function openModal(pid) {
            const p = allProducts.find(i => i.id === pid);
            if (!p) return;

            const modal = document.getElementById('productModal');
            const flipInner = document.getElementById('flipInner');
            
            // 1. Reset trạng thái lật về mặt trước
            flipInner.classList.remove('do-flip');

            // 2. Gán ảnh mặt trước
            document.getElementById('modalImgFront').src = p.images[0];

            // 3. Gán ảnh mặt sau (Nếu không có thì lấy ảnh trước để lật cho vui)
            document.getElementById('modalImgBack').src = p.images[1] ? p.images[1] : p.images[0];

            // 4. Điền thông tin
            document.getElementById('modalCode').innerText = p.code;
            document.getElementById('modalName').innerText = p.name;
            
            const btnShopee = document.getElementById('modalShopee');
            const btnTiktok = document.getElementById('modalTiktok');
            
            if (p.links.shopee) { btnShopee.href = p.links.shopee; btnShopee.classList.remove('hidden'); } else { btnShopee.classList.add('hidden'); }
            if (p.links.tiktok) { btnTiktok.href = p.links.tiktok; btnTiktok.classList.remove('hidden'); } else { btnTiktok.classList.add('hidden'); }

            // 5. Hiện Modal
            modal.classList.remove('hidden');
            setTimeout(() => { modal.classList.add('open'); }, 10);
        }

        function closeModal() {
            const modal = document.getElementById('productModal');
            modal.classList.remove('open');
            setTimeout(() => { modal.classList.add('hidden'); }, 200);
        }

        function flipModalImage() {
            // Đơn giản là thêm/bỏ class do-flip để CSS tự xoay
            const flipInner = document.getElementById('flipInner');
            flipInner.classList.toggle('do-flip');
        }

        // --- FILTER & WHEEL ---
        function filterProducts() {
            const key = document.getElementById('searchInput').value.toLowerCase();
            const filtered = allProducts.filter(p => {
                const matchKey = p.name.toLowerCase().includes(key) || p.code.toLowerCase().includes(key);
                const matchCat = currentCategory === 'all' || p.category === currentCategory;
                return matchKey && matchCat;
            });
            renderProducts(filtered);
        }

        function setCategory(catId) {
            currentCategory = catId;
            document.querySelectorAll('.cat-btn').forEach(btn => btn.classList.remove('active'));
            event.target.classList.add('active');
            filterProducts();
        }

        function openWheel() { document.getElementById('wheelModal').classList.remove('hidden'); }
        function closeWheel() { document.getElementById('wheelModal').classList.add('hidden'); }
        let isSpinning = false;
        function spinWheel() {
            if (isSpinning) return;
            isSpinning = true;
            const wheel = document.getElementById('wheel');
            const result = document.getElementById('wheelResult');
            result.innerText = "...";
            let stopDegree = IS_OUT_OF_STOCK ? 360 * 5 + (Math.random() * 40 + 10) : 360 * 5 + (Math.random() * 40 + 70);
            wheel.style.transform = `rotate(-${stopDegree}deg)`;
            setTimeout(() => {
                isSpinning = false;
                result.innerText = IS_OUT_OF_STOCK ? "Chúc bạn may mắn lần sau!" : "Trúng Voucher: FREESHIP";
                if(!IS_OUT_OF_STOCK) {
                    setTimeout(() => { navigator.clipboard.writeText("FREESHIP"); alert("Đã copy mã: FREESHIP"); closeWheel(); }, 1500);
                }
            }, 4000);
        }

        init();
    </script>
</body>
</html>
